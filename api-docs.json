{"openapi":"3.1.0","info":{"title":"认证服务 API","description":"提供用户认证和授权相关的 API 接口","contact":{"name":"开发团队","url":"https://example.com"},"version":"1.0.0"},"servers":[{"url":"http://localhost:8080","description":"本地开发环境"}],"tags":[{"name":"操作日志","description":"操作日志管理相关接口"},{"name":"用户","description":"用户相关接口"},{"name":"身份认证","description":"身份认证相关接口"}],"paths":{"/api/users/page":{"post":{"tags":["用户"],"summary":"分页查询用户列表","description":"查询后台管理员用户列表，支持按用户名、邮箱、手机号等条件查询，需要用户管理权限","operationId":"getUsersByPage","requestBody":{"description":"用户查询参数","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserQueryParam"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ResultDTOPageVOUserListVO"}}}}}}},"/api/operation-logs/page":{"post":{"tags":["操作日志"],"summary":"分页查询操作日志","description":"支持多条件查询，需要审计管理权限","operationId":"getOperationLogs","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OperationLogQueryParam"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ResultDTOPageOperationLogVo"}}}}}}},"/api/operation-logs/archive":{"post":{"tags":["操作日志"],"summary":"归档旧日志","description":"归档并删除超过6个月的日志，需要审计管理权限","operationId":"archiveOldLogs","responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ResultDTOInteger"}}}}}}},"/api/auth/logout":{"post":{"tags":["身份认证"],"summary":"用户登出","description":"登出并使当前令牌失效","operationId":"logout","responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ResultDTOVoid"}}}}}}},"/api/auth/login":{"post":{"tags":["身份认证"],"summary":"用户登录","description":"用户身份认证，返回 JWT token。支持设备类型参数，同一设备类型仅允许一个活跃会话","operationId":"login","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginParam"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ResultDTOLoginVo"}}}}}}},"/api/users/{userId}/detail":{"get":{"tags":["用户"],"summary":"获取用户详细信息","description":"根据用户ID查询用户详细信息（包含角色和权限），需要用户管理权限或SUPER_ADMIN角色","operationId":"getUserDetail","parameters":[{"name":"userId","in":"path","description":"用户ID","required":true,"schema":{"type":"integer","format":"int64"},"example":1}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ResultDTOUserDetailVo"}}}}}}},"/api/users/me":{"get":{"tags":["用户"],"summary":"获取当前用户","description":"获取当前认证用户的个人信息","operationId":"me","responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ResultDTOUserVo"}}}}}}},"/api/operation-logs/{id}":{"get":{"tags":["操作日志"],"summary":"查询操作日志详情","description":"根据ID查询日志详情，需要审计管理权限","operationId":"getOperationLogById","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ResultDTOOperationLogVo"}}}}}}}},"components":{"schemas":{"UserQueryParam":{"type":"object","description":"用户查询参数","properties":{"pageNum":{"type":"integer","format":"int64","description":"页码，从1开始","example":1},"pageSize":{"type":"integer","format":"int64","description":"每页条数，默认10，最大1000","example":10},"username":{"type":"string","description":"用户名","example":"admin"},"email":{"type":"string","description":"邮箱","example":"admin@example.com"},"phone":{"type":"string","description":"手机号","example":13800138000},"enabled":{"type":"integer","format":"int32","description":"是否启用：0-禁用 1-启用"}}},"PageVOUserListVO":{"type":"object","description":"分页响应对象","properties":{"current":{"type":"integer","format":"int64","description":"当前页码","example":1},"size":{"type":"integer","format":"int64","description":"每页条数","example":10},"total":{"type":"integer","format":"int64","description":"总记录数","example":100},"pages":{"type":"integer","format":"int64","description":"总页数","example":10},"records":{"type":"array","description":"当前页的数据列表","items":{"$ref":"#/components/schemas/UserListVO"}}}},"ResultDTOPageVOUserListVO":{"type":"object","description":"统一响应对象，所有接口返回都被该对象包装","properties":{"code":{"type":"integer","format":"int32","description":"返回码。200=成功、400=参数错误、401=认证错误、403=权限错误、500=系统错误","example":200},"message":{"type":"string","description":"返回信息说明","example":"success"},"data":{"$ref":"#/components/schemas/PageVOUserListVO","description":"响应数据，失败时为 null"}}},"UserListVO":{"type":"object","description":"用户列表项","properties":{"id":{"type":"integer","format":"int64","description":"用户ID","example":1},"username":{"type":"string","description":"用户名","example":"admin"},"email":{"type":"string","description":"邮箱（已脱敏）","example":"ad***@example.com"},"phone":{"type":"string","description":"手机号（已脱敏）","example":"138****8000"},"userType":{"type":"integer","format":"int32","description":"用户类型：1-门户用户，2-后台用户","example":2},"enabled":{"type":"boolean","description":"是否启用","example":true},"createdAt":{"type":"string","description":"创建时间","example":"2024-01-01 10:00:00"}}},"OperationLogQueryParam":{"type":"object","description":"操作日志查询参数","properties":{"pageNum":{"type":"integer","format":"int64","description":"页码，从1开始","example":1},"pageSize":{"type":"integer","format":"int64","description":"每页条数，默认10，最大1000","example":10},"username":{"type":"string","description":"用户名"},"operationType":{"type":"string","description":"操作类型"},"operationModule":{"type":"string","description":"操作模块"},"status":{"type":"string","description":"执行状态：SUCCESS FAIL"},"ipAddress":{"type":"string","description":"IP地址"},"startTime":{"type":"string","format":"date-time","description":"开始时间","example":"2025-01-01 00:00:00"},"endTime":{"type":"string","format":"date-time","description":"结束时间","example":"2025-12-31 23:59:59"}}},"OperationLogVo":{"type":"object","description":"操作日志响应","properties":{"id":{"type":"integer","format":"int64","description":"日志ID"},"userId":{"type":"integer","format":"int64","description":"操作用户ID"},"username":{"type":"string","description":"操作用户名"},"operationType":{"type":"string","description":"操作类型"},"operationModule":{"type":"string","description":"操作模块"},"operationDesc":{"type":"string","description":"操作描述"},"requestMethod":{"type":"string","description":"请求方法"},"requestUrl":{"type":"string","description":"请求URL"},"requestParams":{"type":"string","description":"请求参数"},"responseResult":{"type":"string","description":"返回结果"},"ipAddress":{"type":"string","description":"IP地址"},"deviceType":{"type":"string","description":"设备类型"},"userAgent":{"type":"string","description":"用户代理"},"executeTime":{"type":"integer","format":"int64","description":"执行时长（毫秒）"},"status":{"type":"string","description":"执行状态"},"errorMessage":{"type":"string","description":"错误信息"},"createdAt":{"type":"string","format":"date-time","description":"创建时间"}}},"OrderItem":{"type":"object","properties":{"column":{"type":"string"},"asc":{"type":"boolean"}}},"PageOperationLogVo":{"type":"object","properties":{"records":{"type":"array","items":{"$ref":"#/components/schemas/OperationLogVo"}},"total":{"type":"integer","format":"int64"},"size":{"type":"integer","format":"int64"},"current":{"type":"integer","format":"int64"},"orders":{"type":"array","items":{"$ref":"#/components/schemas/OrderItem"},"writeOnly":true},"optimizeCountSql":{"$ref":"#/components/schemas/PageOperationLogVo","writeOnly":true},"searchCount":{"$ref":"#/components/schemas/PageOperationLogVo","writeOnly":true},"optimizeJoinOfCountSql":{"type":"boolean","writeOnly":true},"maxLimit":{"type":"integer","format":"int64","writeOnly":true},"countId":{"type":"string","writeOnly":true},"pages":{"type":"integer","format":"int64"}}},"ResultDTOPageOperationLogVo":{"type":"object","description":"统一响应对象，所有接口返回都被该对象包装","properties":{"code":{"type":"integer","format":"int32","description":"返回码。200=成功、400=参数错误、401=认证错误、403=权限错误、500=系统错误","example":200},"message":{"type":"string","description":"返回信息说明","example":"success"},"data":{"$ref":"#/components/schemas/PageOperationLogVo","description":"响应数据，失败时为 null"}}},"ResultDTOInteger":{"type":"object","description":"统一响应对象，所有接口返回都被该对象包装","properties":{"code":{"type":"integer","format":"int32","description":"返回码。200=成功、400=参数错误、401=认证错误、403=权限错误、500=系统错误","example":200},"message":{"type":"string","description":"返回信息说明","example":"success"},"data":{"type":"integer","format":"int32","description":"响应数据，失败时为 null"}}},"ResultDTOVoid":{"type":"object","description":"统一响应对象，所有接口返回都被该对象包装","properties":{"code":{"type":"integer","format":"int32","description":"返回码。200=成功、400=参数错误、401=认证错误、403=权限错误、500=系统错误","example":200},"message":{"type":"string","description":"返回信息说明","example":"success"},"data":{"description":"响应数据，失败时为 null"}}},"LoginParam":{"type":"object","description":"登录请求","properties":{"username":{"type":"string","description":"用户名","example":"admin","minLength":1},"password":{"type":"string","description":"密码","example":"admin123","minLength":1},"deviceType":{"type":"string","description":"设备类型：web/ios/android/pc，默认为web","example":"web"}},"required":["password","username"]},"LoginVo":{"type":"object","description":"登录响应","properties":{"token":{"type":"string","description":"JWT 令牌"},"message":{"type":"string","description":"响应信息"}}},"ResultDTOLoginVo":{"type":"object","description":"统一响应对象，所有接口返回都被该对象包装","properties":{"code":{"type":"integer","format":"int32","description":"返回码。200=成功、400=参数错误、401=认证错误、403=权限错误、500=系统错误","example":200},"message":{"type":"string","description":"返回信息说明","example":"success"},"data":{"$ref":"#/components/schemas/LoginVo","description":"响应数据，失败时为 null"}}},"PermissionVo":{"type":"object","description":"权限信息","properties":{"id":{"type":"integer","format":"int64"},"permissionName":{"type":"string"},"permissionCode":{"type":"string"},"permissionType":{"type":"integer","format":"int32"},"modulePath":{"type":"string"},"description":{"type":"string"}}},"ResultDTOUserDetailVo":{"type":"object","description":"统一响应对象，所有接口返回都被该对象包装","properties":{"code":{"type":"integer","format":"int32","description":"返回码。200=成功、400=参数错误、401=认证错误、403=权限错误、500=系统错误","example":200},"message":{"type":"string","description":"返回信息说明","example":"success"},"data":{"$ref":"#/components/schemas/UserDetailVo","description":"响应数据，失败时为 null"}}},"RoleVo":{"type":"object","description":"角色信息","properties":{"id":{"type":"integer","format":"int64"},"roleName":{"type":"string"},"roleCode":{"type":"string"},"roleType":{"type":"integer","format":"int32"},"description":{"type":"string"}}},"UserDetailVo":{"type":"object","description":"用户详细信息（包含RBAC）","properties":{"id":{"type":"integer","format":"int64","description":"用户ID"},"username":{"type":"string","description":"用户名"},"email":{"type":"string","description":"邮箱"},"phone":{"type":"string","description":"手机号"},"userType":{"type":"integer","format":"int32","description":"用户类型：1-门户用户 2-后台管理员"},"enabled":{"type":"boolean","description":"是否启用"},"roles":{"type":"array","description":"角色列表","items":{"$ref":"#/components/schemas/RoleVo"}},"permissions":{"type":"array","description":"权限列表","items":{"$ref":"#/components/schemas/PermissionVo"}}}},"ResultDTOUserVo":{"type":"object","description":"统一响应对象，所有接口返回都被该对象包装","properties":{"code":{"type":"integer","format":"int32","description":"返回码。200=成功、400=参数错误、401=认证错误、403=权限错误、500=系统错误","example":200},"message":{"type":"string","description":"返回信息说明","example":"success"},"data":{"$ref":"#/components/schemas/UserVo","description":"响应数据，失败时为 null"}}},"UserVo":{"type":"object","description":"用户个人信息","properties":{"id":{"type":"integer","format":"int64","description":"用户ID","example":1},"username":{"type":"string","description":"用户名","example":"admin"},"email":{"type":"string","description":"邮箱（已脱敏）","example":"ad***@example.com"},"phone":{"type":"string","description":"手机号（已脱敏）","example":"138****8000"},"userType":{"type":"integer","format":"int32","description":"用户类型：1-门户用户，2-后台用户","example":2},"enabled":{"type":"boolean","description":"是否启用","example":true}}},"ResultDTOOperationLogVo":{"type":"object","description":"统一响应对象，所有接口返回都被该对象包装","properties":{"code":{"type":"integer","format":"int32","description":"返回码。200=成功、400=参数错误、401=认证错误、403=权限错误、500=系统错误","example":200},"message":{"type":"string","description":"返回信息说明","example":"success"},"data":{"$ref":"#/components/schemas/OperationLogVo","description":"响应数据，失败时为 null"}}}}}}